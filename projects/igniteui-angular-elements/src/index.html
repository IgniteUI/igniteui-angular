<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>IgniteuiAngularElements</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    body {
        display: grid;
        gap: 16px;
        grid-auto-rows: minmax(400px, max-content);
    }
    igc-grid, igc-tree-grid {
        max-height: 550px;
        --ig-grid-grouparea-background: #ff000012;
        --ig-grid-drop-area-background: #ff004c12;
        --ig-paginator-border-color:#d0ab23;
    }
    .range-wrapper {
        width: 100%;
        padding: 0 .5rem;
    }
  </style>
</head>
<body class="ig-typography">
    <!-- <app-wrapper>
        <app-child-standalone id="childComp">
            <button onclick="changeText()">Change from child</button>
        </app-child-standalone>
    </app-wrapper>

    <template id="tmpl">
        <p>my templated content</p>
        <p>{{value}}</p>
    </template>
    <script>
        let changeText = () => {
            childComp.text = 'Changed directly from child through ng-content.';
        }
        childComp.template = tmpl;
    </script> -->

  <section>
    <h3 class="ig-typography__h6">Flat Grid (column groups, toolbar, paginator, row actions)</h3>
    <igc-grid id="grid1" moving="true" paging="true" primary-key="ProductID" row-selection="multiple" row-editable="true" allow-filtering="true" filter-mode="excelStyleFilter" display-density="compact">
        <igc-grid-toolbar>
        <igc-grid-toolbar-title>My new toolbar</igc-grid-toolbar-title>
        <igc-grid-toolbar-actions>
            <igc-grid-toolbar-advanced-filtering></igc-grid-toolbar-advanced-filtering>
            <igc-grid-toolbar-hiding></igc-grid-toolbar-hiding>
            <igc-grid-toolbar-pinning></igc-grid-toolbar-pinning>
            <igc-grid-toolbar-exporter>
                <span excelText>Export Excel</span>
                <span csvText>Export CSV</span>
            </igc-grid-toolbar-exporter>
            <igc-grid-toolbar-exporter></igc-grid-toolbar-exporter>
        </igc-grid-toolbar-actions>
        </igc-grid-toolbar>
        <igc-grid-state id="state"></igc-grid-state>


        <igc-column field="ProductID" header="Product ID" data-type="number" filterable="false"></igc-column>
        <igc-column field="ProductName" header="Product Name" sortable="true" width="auto"></igc-column>

        <igc-column field="CategoryName" header="Category Name" sortable="true" groupable="true"></igc-column>
        <igc-column field="InStock" header="In Stock" data-type="number"></igc-column>

        <igc-action-strip>
            <igc-grid-pinning-actions></igc-grid-pinning-actions>
            <igc-grid-editing-actions add-row="true"></igc-grid-editing-actions>
        </igc-action-strip>

        <igc-paginator per-page="10"></igc-paginator>
    </igc-grid>

    <button id="saveState">Save state</button>
    <button id="restoreState">Restore</button>
    <button onclick="changeColumns()">Change columns</button>
    <button onclick="grid1.selectAllColumns()">selectAllColumns</button>
    <button onclick="grid1.deselectAllColumns()">deselectAllColumns</button>
    <button onclick="grid1.displayDensity = 'compact'">Compact</button>
    <button onclick="grid1.displayDensity = 'cosy'">Cosy</button>
    <button onclick="grid1.displayDensity = 'comfortable'">Comfortable</button>

    <h3 class="ig-typography__h6">Standalone paginator</h3>
    <igc-paginator per-page="25" total-records="150"></igc-paginator>
  </section>

  <section>
      <h3 class="ig-typography__h6">Flat Grid (MRL column layout)</h3>
      <igc-grid id="grid2" moving="true" paging="true" primary-key="ProductID" row-editable="true" allow-filtering="true" filter-mode="excelStyleFilter" display-density="compact">
        <igc-grid-toolbar>
        <igc-grid-toolbar-title>My new toolbar</igc-grid-toolbar-title>
        <igc-grid-toolbar-actions>
            <igc-grid-toolbar-hiding></igc-grid-toolbar-hiding>
            <igc-grid-toolbar-pinning></igc-grid-toolbar-pinning>
            <igc-grid-toolbar-exporter></igc-grid-toolbar-exporter>
        </igc-grid-toolbar-actions>
        </igc-grid-toolbar>

        <igc-column-layout header="Product ID">
            <igc-column row-start="1" col-start="1" row-end="3" field="ProductID" header="Product ID" width="25%"></igc-column>
        </igc-column-layout>
        <igc-column-layout header="Product Details" width="50%">
            <igc-column row-start="1" col-start="1" col-end="3" field="ProductName" header="Product Name"></igc-column>
            <igc-column row-start="2" col-start="1" col-end="2" field="CategoryName" header="Category Name" groupable="true"></igc-column>
            <igc-column row-start="2" col-start="2" col-end="3" field="ImageUrl"></igc-column>
        </igc-column-layout>
        <igc-column-layout header="Product Stock">
            <igc-column row-start="1" col-start="1" col-end="3" field="InStock" header="In Stock" width="25%"></igc-column>
        </igc-column-layout>

        <igc-paginator per-page="10"></igc-paginator>
      </igc-grid>
  </section>

  <script src="assets/data/nw-products.js"></script>
  <script type="module">
    import { html } from "/lit-html.js";
    import { defineComponents, IgcSelectComponent, IgcComboComponent, IgcButtonComponent } from "igniteui-webcomponents";
    // import "igniteui-webcomponents/themes/light/bootstrap.css";

    defineComponents(IgcSelectComponent, IgcComboComponent, IgcButtonComponent);
    const grid1 = document.getElementById('grid1');
    const grid2 = document.getElementById('grid2');
    grid1.data = northwindProducts;
    grid2.data = northwindProducts;
    const categories = Array.from(new Set(northwindProducts.map(x => x.CategoryName)));

    let groupingExpression1 = [];
    var groupingExpression2 = {};
    groupingExpression2.fieldName = "CategoryName";
    groupingExpression2.dir = 1 /* SortingDirection.Asc */;
    groupingExpression2.ignoreCase = false;
    groupingExpression1.push(groupingExpression2)

    grid1.groupingExpressions = groupingExpression1;

    document.addEventListener('DOMContentLoaded', () => {
        grid1.emptyGridTemplate = () => html`<div>Â¯\(Â°_o)/Â¯ no data</div>`;
        grid1.dropAreaTemplate = () => html`<span> ðŸ‘‰ Drop here ðŸ‘ˆ </span>`;
        grid1.querySelector('igc-column').bodyTemplate = (context) => html`PK: ${context.implicit}`;
        grid1.querySelector('igc-column[field="ProductName"]').bodyTemplate = (context) => {
            return html`
            <igc-button size="large" class="button">
            ${context.implicit}
            </igc-button>`;
        };
        grid1.querySelector('igc-column[field="InStock"]').inlineEditorTemplate = (context) =>
            html`<div class="range-wrapper">
                <input autofocus id="range" type="range"
                    .value="${context.implicit}"
                    @change=${e => context.cell.editValue = e.target.nextElementSibling.value = e.target.value}
                    />
                <output .value="${context.$implicit}"></output>
            </div>`;
        grid1.querySelector('igc-column[field="CategoryName"]').inlineEditorTemplate = (ctx) =>
            html`
            <igc-select .value="${ctx.cell.editValue}" style="width:100%; height:100%" @igcChange=${(e) => ctx.cell.editValue = e.detail.value}>
                ${categories.map(x => html`<igc-select-item value="${x}">${x}</igc-select-item>`)}
            </igc-select>
        `;
        grid1.querySelector('igc-column[field="ProductName"]').inlineEditorTemplate = (ctx) =>
            html`
            <igc-combo style="width:100%; height:100%" .data=${northwindProducts} value-key="ProductName" @igcChange=${(e) => ctx.cell.editValue = e.detail.newValue} single-select>
            </igc-combo>
        `;
        grid1.detailTemplate = (ctx) => html`<div><span class="categoryStyle">Stock: ${ctx.implicit.InStock}</span></div>`;

        grid2.querySelector('igc-column[field="ProductName"]').inlineEditorTemplate = (ctx) =>
            html`
            <igc-input .value="${ctx.cell.editValue}" style="width:100%; height:100%" @igcChange=${(e) => ctx.cell.editValue = e.detail.value}>
            </igc-input>
        `;

        document.getElementById("saveState").addEventListener("click", saveState);
        document.getElementById("restoreState").addEventListener("click", restoreState);
        const stateComponent = document.getElementById('state');
        stateComponent.options = {
            paging: false
        };
    });

    function saveState() {
        const stateComponent = document.getElementById('state');
        const stringData = stateComponent.getStateAsString();
        window.localStorage.setItem(`grid1-state`, stringData);
    }

    function restoreState() {
        const stateComponent = document.getElementById('state');
        const stateData = window.localStorage.getItem(`grid1-state`);
        if (stateData) {
            const obj = JSON.parse(stateData);
            stateComponent.applyState(obj);
        }
    }

    function changeColumns() {
        let columns = [
            { field: 'ProductID', dataType: 'number', resizable: true },
            { field: 'ProductName', resizable: true },
            { field: 'CategoryName', resizable: true }
        ];
        grid1.columns = columns;
    }
  </script>

  <!-- IgxTreeGridComponent -->
  <igc-tree-grid id="treegrid1" primary-key="id" row-editable="true" moving="true" allow-filtering="true" filter-mode="excelStyleFilter" display-density="compact" child-data-key="products">
    <igc-grid-toolbar>
        <igc-grid-toolbar-title>Tree Grid Toolbar</igc-grid-toolbar-title>
        <igc-grid-toolbar-actions>
            <igc-grid-toolbar-advanced-filtering></igc-grid-toolbar-advanced-filtering>
            <igc-grid-toolbar-hiding></igc-grid-toolbar-hiding>
            <igc-grid-toolbar-pinning></igc-grid-toolbar-pinning>
            <igc-grid-toolbar-exporter></igc-grid-toolbar-exporter>
        </igc-grid-toolbar-actions>
    </igc-grid-toolbar>
    <igc-column field='id' header='Project Id' data-type='number' ></igc-column>
    <igc-column field='tasks' sortable ></igc-column>
    <igc-column field='start' data-type='date' sortable has-summary></igc-column>
    <igc-column field='finish' data-type='date' has-summary></igc-column>
    <igc-paginator per-page="10"></igc-paginator>
    <igc-action-strip>
        <igc-grid-pinning-actions></igc-grid-pinning-actions>
        <igc-grid-editing-actions add-row="true"></igc-grid-editing-actions>
    </igc-action-strip>
  </igc-tree-grid>

  <script src="assets/data/tree-grid-ds.js"></script>
  <script>
    treegrid1.data = treeGridDS;
    document.addEventListener('DOMContentLoaded', () => {
        // treegrid1.columns = [
        //     { field: 'id', header: 'Product Id', dataType: 'number' },
        //     { field: 'tasks', sortable: true },
        //     { field: 'start', dataType: 'date', sortable: true, groupable: true, hasSummary: true },
        //     { field: 'finish', dataType: 'date', hasSummary: true }
        // ];
    });
  </script>
  <!-- END IgxTreeGridComponent -->

  <igc-hierarchical-grid id="hgrid1" moving="true" allow-filtering="true" filter-mode="excelStyleFilter" display-density="compact">
    <igc-grid-state id="state2"></igc-grid-state>
    <igc-column field="ProjectId" data-type="number" header="Project Id" sortable="true" selectable="false"></igc-column>
    <igc-column field="Name" data-type="string" header="Name" sortable="true" selectable="false"></igc-column>
    <igc-column field="StartDate" data-type="date" header="Start Date" sortable="true" selectable="false"></igc-column>
    <igc-column field="EndDate" data-type="date" header="End Date" sortable="true" selectable="false"></igc-column>
    <igc-column field="IsPostponed" data-type="boolean" header="Postponed" sortable="true" selectable="false"></igc-column>

    <igc-row-island id="DevelopersRowIsland" key="Developers">
        <igc-column field="Name" header="Name" sortable="true"></igc-column>
        <igc-column-group header="Position Information">
            <igc-column-group header="Position Details" collapsible>
                <igc-column field="Position" header="Position" sortable="true" visible-when-collapsed></igc-column>
                <igc-column field="Salary" header="Salary" sortable="true" visible-when-collapsed="false"></igc-column>
            </igc-column-group>
            <igc-column field="HireDate" header="HireDate" data-type="date" sortable="true"></igc-column>
        </igc-column-group>
        <igc-action-strip>
            <igc-grid-pinning-actions></igc-grid-pinning-actions>
            <igc-grid-editing-actions add-row="true"></igc-grid-editing-actions>
        </igc-action-strip>
        <igc-row-island auto-generate id="VirtualMachinesRowIsland" key="VirtualMachines"></igc-row-island>
    </igc-row-island>
    <igc-paginator per-page="10"></igc-paginator>
    <igc-action-strip>
        <igc-grid-pinning-actions></igc-grid-pinning-actions>
        <igc-grid-editing-actions add-row="true"></igc-grid-editing-actions>
    </igc-action-strip>
  </igc-hierarchical-grid>

  <!-- IgxPivotGridComponent -->
  <igc-pivot-grid id="pivotgrid1" default-expand-state="true" row-selection="single"></igc-pivot-grid>

  <script src="assets/data/pivot-data.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const clear = (el) => el === 0 || Boolean(el);
        pivotgrid1.pivotConfiguration = {
            columns: [
                {
                    memberName: 'Country',
                    enabled: true
                }
            ],
            rows: [
                {
                    memberName: 'City',
                    enabled: true
                }
            ],
            values: [
                {
                    member: 'UnitsSold',
                    aggregate: {
                        key: 'SUM',
                        aggregator: (data) => data.length && data.filter(clear).length ? data.filter(clear).reduce((a, b) => +a + +b) : 0,
                        label: 'Sum'
                    },
                    enabled: true,
                    styles: {
                        upFont: (rowData, columnKey) => rowData[columnKey] > 300,
                        downFont: (rowData, columnKey) => rowData[columnKey] <= 300
                    },
                    // dataType: 'currency',
                    formatter: (value) => value ? value + '$' : undefined
                },
                {
                    member: 'AmountOfSale',
                    displayName: 'Amount of Sale',
                    aggregate: {
                        key: 'SUM',
                        aggregator: (members, data) => data.reduce((accumulator, value) => accumulator + value.UnitPrice * value.UnitsSold, 0),
                        label: 'Sum of Sale'
                    },
                    aggregateList: [{
                        key: 'SUM',
                        aggregator: (members, data) => data.reduce((accumulator, value) => accumulator + value.UnitPrice * value.UnitsSold, 0),
                        label: 'Sum of Sale'
                    }, {
                        key: 'MIN',
                        aggregator: (members, data) => {
                            let min = 0;
                            if (data.length === 1) {
                                min = data[0].UnitPrice * data[0].UnitsSold;
                            } else if (data.length > 1) {
                                const mappedData = data.map(x => x.UnitPrice * x.UnitsSold);
                                min = mappedData.reduce((a, b) => Math.min(a, b));
                            }
                            return min;
                        },
                        label: 'Minimum of Sale'
                    }, {
                        key: 'MAX',
                        aggregator: (members, data) => {
                            let max = 0;
                            if (data.length === 1) {
                                max = data[0].UnitPrice * data[0].UnitsSold;
                            } else if (data.length > 1) {
                                const mappedData = data.map(x => x.UnitPrice * x.UnitsSold);
                                max = mappedData.reduce((a, b) => Math.max(a,b));
                            }
                            return max;
                        },
                        label: 'Maximum of Sale'
                    }],
                    enabled: true,
                    dataType: 'currency',
                    styles: {
                        upFont1: (rowData, columnKey) => rowData[columnKey] > 50,
                        downFont1: (rowData, columnKey) => rowData[columnKey] <= 50
                    },
                }
            ],
            filters: [
                {
                    memberName: 'SellerName',
                    enabled: true,
                    //filter: this.filterExpTree
                }
            ]
        };
    });
    pivotgrid1.data = pivotData;
  </script>
  <!-- END IgxPivotGridComponent -->

  <script type="module">
    import { html } from "/lit-html.js";
    // jump around vite import analysis with dynamic import url
    const hgridData = (await import(`/assets/${'data'}/projects-hgrid.js`)).default;
    let hgrid = document.getElementById('hgrid1');
    hgrid.data = hgridData;

    let developersRowIsland = document.getElementById('DevelopersRowIsland');
    let virtualMachinesRowIsland = document.getElementById('VirtualMachinesRowIsland');
    virtualMachinesRowIsland.paginatorTemplate = (ctx) => html`
        <igc-paginator per-page="5"></igc-paginator>
    `;
    developersRowIsland.paginatorTemplate = (ctx) => html`
        <igc-paginator per-page="5"></igc-paginator>
    `;
    developersRowIsland.toolbarTemplate = (ctx) => html`
        <igc-grid-toolbar>
            <igc-grid-toolbar-title>My new toolbar</igc-grid-toolbar-title>
            <igc-grid-toolbar-actions>
                <igc-grid-toolbar-advanced-filtering></igc-grid-toolbar-advanced-filtering>
                <igc-grid-toolbar-hiding></igc-grid-toolbar-hiding>
                <igc-grid-toolbar-pinning></igc-grid-toolbar-pinning>
                <igc-grid-toolbar-exporter>
                    <span excelText>Export Excel</span>
                    <span csvText>Export CSV</span>
                </igc-grid-toolbar-exporter>
                <igc-grid-toolbar-exporter></igc-grid-toolbar-exporter>
            </igc-grid-toolbar-actions>
        </igc-grid-toolbar>
    `;
  </script>
</body>
</html>

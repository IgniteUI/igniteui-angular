@use 'sass:map';
@use 'sass:math';
@use 'igniteui-theming/sass/animations' as *;
@use 'igniteui-theming/sass/bem' as *;
@use 'igniteui-theming/sass/themes' as *;
@use 'igniteui-theming/sass/typography' as *;
@use 'igniteui-theming/sass/color/functions' as *;
@use './light/themes' as *;

$theme: $material;

@include scale-in-out($start-scale: .9);

$input-transition: all .2s $ease-in-out-quad;

%switch-composite--hover {
    border-color: var-get($theme, 'border-hover-color');

    %switch-thumb {
        background: var-get($theme, 'border-hover-color');
    }

    %switch-thumb--x {
        background: var-get($theme, 'thumb-on-color');
    }
}

%switch-composite--x {
    background: var-get($theme, 'track-on-color');
    border-color: var-get($theme, 'border-on-color');

    //ripple color
    --color: #{var-get($theme, 'thumb-on-color')};
}

%switch-composite--x--hover {
    background: var-get($theme, 'track-on-hover-color');
    border-color: var-get($theme, 'border-on-hover-color');

    %switch-thumb {
        background: var-get($theme, 'thumb-on-color');
    }
}

%switch-thumb {
    position: relative;
    display: block;
    width: var(--switch-thumb-size);
    height: var(--switch-thumb-size);
    min-width: var(--switch-thumb-size);
    border-radius: var-get($theme, 'border-radius-thumb');
    background: var-get($theme, 'thumb-off-color');
    transition: $input-transition;
}

%switch-thumb--x {
    background: var-get($theme, 'thumb-on-color');
}

%switch-label {
    display: inline-block;
    color: var-get($theme, 'label-color');
    user-select: none;
    word-wrap: break-all;

    &:empty {
        margin: 0;
    }
}

// all ripple styles may be moved to material only
%switch-ripple {
    --_ripple-size: #{rem(40px)};

    display: none;
    position: absolute;
    top: calc(50% - calc(var(--_ripple-size) / 2));
    inset-inline-start: calc(50% - calc(var(--_ripple-size) / 2));
    width: var(--_ripple-size);
    aspect-ratio: 1;
    overflow: hidden;
    pointer-events: none;
    filter: opacity(1);
    border-radius: var-get($theme, 'border-radius-ripple');
}

%switch-ripple--focused {
    background: color($color: 'gray', $variant: 600);
    transition: background .2s $ease-out-quad;
    opacity: .12;

    @container style(--ig-theme-variant: dark) {
        opacity: .24;
    }
}

%switch-ripple--hover {
    &::after {
        position: absolute;
        content: '';
        opacity: .06;
        inset: 0;

        @container style(--ig-theme-variant: dark) {
            opacity: .12;
        }
    }
}

%switch-ripple--hover-unchecked {
    &::after {
        background: color($color: 'gray', $variant: 600);
    }
}

%switch-ripple--hover-checked {
    &::after {
        background: var-get($theme, 'thumb-on-color');
    }
}

%switch-ripple--hover-invalid {
    &::after {
        background: var-get($theme, 'error-color-hover');
    }
}

%switch-ripple--hover-checked-invalid {
    &::after {
        background: var-get($theme, 'thumb-on-color');
    }
}

// doble check the color
%switch-ripple--pressed {
    &::after {
        opacity: .12;

        @container style(--ig-theme-variant: dark) {
            opacity: .24;
        }
    }
}

@include b(igx-switch) {
    @include css-vars-from-theme($base, 'igx-switch');

    position: relative;
    display: inline-flex;
    flex-flow: row nowrap;
    align-items: center;
    cursor: pointer;

    &:hover {
        @include e(ripple) {
            @extend %switch-ripple--hover !optional;
            @extend %switch-ripple--hover-unchecked !optional;
        }

        @include e(composite) {
            @extend %switch-composite--hover !optional;
        }

        @include e(label) {
            color: var-get($theme, 'label-hover-color');
        }

        @include e(label, $m: before) {
            color: var-get($theme, 'label-hover-color');
        }
    }

    &:active {
        @include e(ripple) {
            @extend %switch-ripple--hover !optional;
            @extend %switch-ripple--hover-unchecked !optional;
            @extend %switch-ripple--pressed !optional;
        }
    }

    @include e(input) {
        @include hide-default();
    }

    @include e(composite) {
        display: flex;
        align-items: center;
        width: var(--switch-width);
        height: var(--switch-height);
        border: rem(1px) solid var-get($theme, 'border-color');
        border-radius: var-get($theme, 'border-radius-track');
        background: var-get($theme, 'track-off-color');
        user-select: none;
        transition: $input-transition;

        //ripple color
        --color: #{var-get($theme, 'track-off-color')};
    }

    @include e(composite-thumb) {
        width: var(--switch-thumb-size);
        height: var(--switch-thumb-size);
        min-width: var(--switch-thumb-size);
        border-radius: var-get($theme, 'border-radius-thumb');
        transition: $input-transition;
        transform: translateX(var(--switch-off-offset));

        [dir='rtl'] & {
            transform: translateX(calc(var(--switch-off-offset) * -1));
        }
    }

    @include e(thumb) {
        @extend %switch-thumb !optional;
    }

    @include e(ripple) {
        @extend %switch-ripple !optional;
    }

    @include e(label) {
        @extend %switch-label !optional;

        margin-inline-start: var(--label-margin);
    }

    @include e(label, $m: before) {
        @extend %switch-label !optional;

        order: -1;
        margin-inline-end: var(--label-margin);
    }

    @include m(focused) {
        @extend  %igx-switch--focused !optional;

        @include e(ripple) {
            @extend %switch-ripple--focused !optional;
        }

        &:hover {
            @include e(composite) {
                @extend %igx-switch--focused--hover !optional;
            }
        }
    }

    @include mx(focused, checked) {
        @extend  %igx-switch--focused-checked !optional;

        &:hover {
            @include e(composite) {
                @extend %switch-composite--hover !optional;
                @extend %switch-composite--x--hover !optional;
            }
        }
    }

    @include mx(disabled, checked) {
        %switch-composite--x {
            background: var-get($theme, 'track-on-disabled-color');
        }
    
        %switch-thumb--x {
            background: var-get($theme, 'thumb-on-disabled-color');
        }
    }

    @include m(checked) {
        @include e(composite) {
            @extend %switch-composite--x !optional;
        }

        @include e(composite-thumb) {
            transform: translateX(calc(var(--switch-width) - var(--switch-thumb-size) - var(--switch-on-offset)));

            [dir='rtl'] & {
                transform: translateX(calc((var(--switch-width) - var(--switch-thumb-size) - var(--switch-on-offset)) * -1));
            }
        }

        @include e(thumb) {
            @extend %switch-thumb--x !optional;
        }

        &:hover {
            @include e(ripple) {
                @extend %switch-ripple--hover !optional;
                @extend %switch-ripple--hover-checked !optional;
            }

            @include e(composite) {
                @extend %switch-composite--x--hover !optional;
            }
        }

        &:active {
            @include e(ripple) {
                @extend %switch-ripple--hover !optional;
                @extend %switch-ripple--hover-checked !optional;
                @extend %switch-ripple--pressed !optional;
            }
        }
    }

    @include m(invalid) {
        @include e(composite) {
            border-color: var-get($theme, 'error-color');
        }

        &:hover {
            @include e(ripple) {
                @extend %switch-ripple--hover !optional;
                @extend %switch-ripple--hover-invalid !optional;
            }

            @include e(composite) {
                @extend %switch-composite--invalid--hover !optional;
            }
        }

        &:active {
            @include e(ripple) {
                @extend %switch-ripple--hover !optional;
                @extend %switch-ripple--hover-invalid !optional;
                @extend %switch-ripple--pressed !optional;
            }
        }

        @include e(label) {
            color: var-get($theme, 'label-invalid-color');
        }
      
        @include e(label, $m: before) {
            color: var-get($theme, 'label-invalid-color');
        }

        @include e(thumb) {
            background: var-get($theme, 'error-color');
        }
    }

    @include mx(invalid, checked) {
        @include e(thumb) {
            background: var-get($theme, 'thumb-on-error-color');
        }

        &:hover {
            @include e(ripple) {
                @extend %switch-ripple--hover !optional;
                @extend %switch-ripple--hover-checked-invalid !optional;
            }
        }
    }

    @include m(disabled) {
        user-select: none;
        pointer-events: none;
        cursor: initial;

        @include e(composite) {
            background: var-get($theme, 'track-disabled-color');
            border-color: var-get($theme, 'border-disabled-color');
        }

        @include e(thumb) {
            background: var-get($theme, 'thumb-disabled-color');
        }

        @include e(label) {
            color: var-get($theme, 'label-disabled-color');
        }

        @include e(label, $m: before) {
            color: var-get($theme, 'label-disabled-color');
        }
    }

    @include mx(disabled, invalid) {
        @include e(thumb) {
            background: var-get($theme, 'thumb-disabled-color');
        }
    }

    @include mx(focused, checked) {
        @include e(ripple) {
            @extend %switch-ripple--focused !optional;

            background: var-get($theme, 'thumb-on-color');
        }
    }

    @include mx(focused, invalid) {
        @include e(ripple) {
            @extend %switch-ripple--focused !optional;

            background: var-get($theme, 'error-color-hover');
        }

        @extend %igx-switch--focused--invalid !optional;
    }
}
